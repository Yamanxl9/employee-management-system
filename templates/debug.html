<!DOCTYPE html>
<html>
<head>
    <title>ØªØ´Ø®ÙŠØµ Ø³Ø±ÙŠØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; direction: rtl; }
        .test-btn { margin: 10px; padding: 10px; background: #007bff; color: white; border: none; cursor: pointer; }
        .result { margin: 10px; padding: 10px; border: 1px solid #ccc; }
        .error { background: #ffebee; }
        .success { background: #e8f5e8; }
    </style>
</head>
<body>
    <h1>ØªØ´Ø®ÙŠØµ Ø³Ø±ÙŠØ¹ Ù„Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h1>
    
    <button class="test-btn" onclick="checkToken()">1. ÙØ­Øµ Token</button>
    <button class="test-btn" onclick="testStatistics()">2. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</button>
    <button class="test-btn" onclick="testFilters()">3. Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ÙÙ„Ø§ØªØ±</button>
    <button class="test-btn" onclick="checkElements()">4. ÙØ­Øµ Ø§Ù„Ø¹Ù†Ø§ØµØ±</button>
    
    <div id="results"></div>

    <script>
        function addResult(message, isError = false) {
            const div = document.createElement('div');
            div.className = 'result ' + (isError ? 'error' : 'success');
            div.innerHTML = message;
            document.getElementById('results').appendChild(div);
        }

        function checkToken() {
            const token = localStorage.getItem('authToken');
            if (token) {
                addResult(`âœ… Token Ù…ÙˆØ¬ÙˆØ¯: ${token.substring(0, 30)}...`);
            } else {
                addResult('âŒ Token ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ localStorage', true);
            }
        }

        function getAuthHeaders() {
            const token = localStorage.getItem('authToken');
            return {
                'Content-Type': 'application/json',
                'Authorization': token ? `Bearer ${token}` : ''
            };
        }

        async function testStatistics() {
            try {
                addResult('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± API Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª...');
                
                const response = await fetch('/api/statistics', {
                    headers: getAuthHeaders()
                });
                
                addResult(`ğŸ“Š Status Code: ${response.status}`);
                
                if (response.status === 401) {
                    addResult('âŒ Ø®Ø·Ø£ Ù…ØµØ§Ø¯Ù‚Ø© - ÙŠØ¬Ø¨ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„', true);
                    return;
                }
                
                const data = await response.json();
                addResult(`âœ… Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†: ${data.total_employees}`);
                addResult(`ğŸ“ Ø¬ÙˆØ§Ø²Ø§Øª Ù…ÙÙ‚ÙˆØ¯Ø©: ${data.passport_missing}`);
                addResult(`ğŸ’³ Ø¨Ø·Ø§Ù‚Ø§Øª Ù…ÙÙ‚ÙˆØ¯Ø©: ${data.cards_missing}`);
                addResult(`â° Ø¨Ø·Ø§Ù‚Ø§Øª Ù…Ù†ØªÙ‡ÙŠØ©: ${data.cards_expired}`);
                
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£: ${error.message}`, true);
            }
        }

        async function testFilters() {
            try {
                addResult('ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ø®ØªØ¨Ø§Ø± API Ø§Ù„ÙÙ„Ø§ØªØ±...');
                
                const response = await fetch('/api/filters', {
                    headers: getAuthHeaders()
                });
                
                if (response.status === 401) {
                    addResult('âŒ Ø®Ø·Ø£ Ù…ØµØ§Ø¯Ù‚Ø© ÙÙŠ Ø§Ù„ÙÙ„Ø§ØªØ±', true);
                    return;
                }
                
                const data = await response.json();
                addResult(`âœ… Ø¹Ø¯Ø¯ Ø§Ù„Ø¬Ù†Ø³ÙŠØ§Øª: ${data.nationalities.length}`);
                addResult(`âœ… Ø¹Ø¯Ø¯ Ø§Ù„Ø´Ø±ÙƒØ§Øª: ${data.companies.length}`);
                addResult(`âœ… Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù: ${data.jobs.length}`);
                
            } catch (error) {
                addResult(`âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙÙ„Ø§ØªØ±: ${error.message}`, true);
            }
        }

        function checkElements() {
            const elements = [
                'totalEmployees',
                'passportMissing', 
                'cardsMissing',
                'cardsExpired'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    addResult(`âœ… Ø¹Ù†ØµØ± ${id} Ù…ÙˆØ¬ÙˆØ¯`);
                } else {
                    addResult(`âŒ Ø¹Ù†ØµØ± ${id} ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯`, true);
                }
            });
        }

        // ÙØ­Øµ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.onload = function() {
            addResult('ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´Ø®ÙŠØµ...');
            checkToken();
        };
    </script>
</body>
</html>
